<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jeu Simon</title>
    <style>
      body {
        background-color: #111;
        color: #fff;
        font-family: "Segoe UI", sans-serif;
        text-align: center;
        padding: 20px;
      }

      h1 {
        font-size: 2.5em;
      }

      .menu,
      .language,
      .difficulty {
        margin: 20px 0;
      }

      .menu-btn {
        padding: 10px 20px;
        margin: 10px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        background-color: #333;
        color: #fff;
        transition: background 0.3s, transform 0.2s;
      }

      .menu-btn:hover {
        background-color: #555;
        transform: scale(1.05);
      }

      .button-container {
        display: grid;
        grid-template-columns: repeat(2, 150px);
        gap: 20px;
        justify-content: center;
        margin: 30px 0;
      }

      .btn {
        width: 150px;
        height: 150px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        opacity: 1;
        transition: all 0.2s;
      }

      .btn:hover {
        filter: brightness(1.3);
        transform: scale(1.03);
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
      }

      .btn:active {
        transform: scale(0.95);
        box-shadow: 0 0 10px #fff;
      }

      #green {
        background: green;
      }
      #red {
        background: red;
      }
      #yellow {
        background: yellow;
        color: black;
      }
      #blue {
        background: blue;
      }

      .score {
        margin-top: 20px;
        font-size: 1.2em;
      }

      #status {
        margin-top: 20px;
        font-weight: bold;
        font-size: 1.5em;
      }
    </style>
  </head>
  <body>
    <h1 id="title">Jeu Simon</h1>

    <div class="menu">
      <button class="menu-btn" onclick="startGame()">
        <span id="btn-start">üéÆ Lancer le jeu</span>
      </button>
      <button class="menu-btn" onclick="showVersion()">‚ÑπÔ∏è Version</button>
      <button class="menu-btn" onclick="selectLanguage()">
        üåê <span id="btn-langue">Langue</span>
      </button>
      <button class="menu-btn" onclick="resetScores()">
        üóëÔ∏è <span id="btn-reset">Reset Scores</span>
      </button>
    </div>

    <div class="language" style="display: none">
      <h3 id="choose-lang">Choisir la langue :</h3>
      <button class="menu-btn" onclick="setLanguage(0)">üá´üá∑ Fran√ßais</button>
      <button class="menu-btn" onclick="setLanguage(1)">üá¨üáß English</button>
      <button class="menu-btn" onclick="setLanguage(2)">üá™üá∏ Espa√±ol</button>
    </div>

    <div class="difficulty" style="display: none">
      <h3 id="choose-difficulty">Choisir la difficult√© :</h3>
      <button class="menu-btn" onclick="setDifficulty(0)">Facile</button>
      <button class="menu-btn" onclick="setDifficulty(1)">Normal</button>
      <button class="menu-btn" onclick="setDifficulty(2)">Difficile</button>
    </div>

    <div class="button-container" id="gameButtons" style="display: none">
      <button class="btn" id="green" onclick="handleUserInput(0)"></button>
      <button class="btn" id="red" onclick="handleUserInput(1)"></button>
      <button class="btn" id="yellow" onclick="handleUserInput(2)"></button>
      <button class="btn" id="blue" onclick="handleUserInput(3)"></button>
    </div>

    <div class="score">
      <p id="score">Score : 0</p>
      <p id="highScore">Meilleur score : 0</p>
      <p id="top3"></p>
    </div>

    <div id="status"></div>
    <div id="backMenu" style="display: none; margin-top: 20px">
      <button class="menu-btn" onclick="goToMenu()">üè† Retour au menu</button>
    </div>

    <script>
      let sequence = [],
        userSequence = [],
        level = 0;
      // High scores par difficult√© : 0=Facile,1=Normal,2=Difficile
      let highScores = JSON.parse(
        localStorage.getItem("simonHighScores") || "[0,0,0]"
      );
      let language = parseInt(localStorage.getItem("simonLang") || 0);
      let difficulty = 1;

      const colors = ["green", "red", "yellow", "blue"];
      const delay = (ms) => new Promise((res) => setTimeout(res, ms));

      const messages = {
        start: ["Le jeu commence !", "Game starts!", "¬°Empieza el juego!"],
        lose: ["Perdu !", "Game Over!", "¬°Perdiste!"],
        win: ["Bravo !", "Good job!", "¬°Bien hecho!"],
        chooseLang: [
          "Choisir la langue :",
          "Choose a language:",
          "Elige un idioma:",
        ],
        chooseDiff: [
          "Choisir la difficult√© :",
          "Choose difficulty:",
          "Elige dificultad:",
        ],
        scoreText: ["Score : ", "Score: ", "Puntuaci√≥n: "],
        highText: ["Meilleur score : ", "Highscore: ", "R√©cord: "],
        btnStart: ["üéÆ Lancer le jeu", "üéÆ Start Game", "üéÆ Iniciar juego"],
        btnLang: ["Langue", "Language", "Idioma"],
        btnReset: [
          "R√©initialiser les scores",
          "Reset Scores",
          "Reiniciar puntuaciones",
        ],
      };

      function showBackToMenuButton(show) {
        document.getElementById("backMenu").style.display = show
          ? "block"
          : "none";
      }

      function goToMenu() {
        document.querySelector(".menu").style.display = "block";
        document.querySelector(".language").style.display = "none";
        document.querySelector(".difficulty").style.display = "none";
        document.getElementById("gameButtons").style.display = "none";
        document.getElementById("backMenu").style.display = "none";
        document.getElementById("status").textContent = "";
        updateScore();
      }

      function updateTexts() {
        document.getElementById("title").textContent = "Jeu Simon";
        document.getElementById("btn-start").textContent =
          messages.btnStart[language];
        document.getElementById("btn-langue").textContent =
          messages.btnLang[language];
        document.getElementById("btn-reset").textContent =
          messages.btnReset[language];
        document.getElementById("choose-lang").textContent =
          messages.chooseLang[language];
        document.getElementById("choose-difficulty").textContent =
          messages.chooseDiff[language];
        updateScore();
      }

      function updateScore() {
        document.getElementById("score").textContent =
          messages.scoreText[language] + level;
        document.getElementById("highScore").textContent =
          messages.highText[language] + highScores[difficulty];
      }

      function startGame() {
        sequence = [];
        level = 0;
        userSequence = [];
        document.querySelector(".menu").style.display = "none";
        document.querySelector(".difficulty").style.display = "block";
        document.getElementById("backMenu").style.display = "block";
        updateStatus(messages.start[language]);
      }

      function showVersion() {
        let versionMsg = "";
        switch (language) {
          case 0: // Fran√ßais
            versionMsg = "Jeu Simon Version 1.1.2 - D√©velopp√© par Th√©o Fief";
            break;
          case 1: // Anglais
            versionMsg = "Simon Game Version 1.1.2 - Developed by Th√©o Fief";
            break;
          case 2: // Espagnol
            versionMsg =
              "Juego Simon Versi√≥n 1.1.2 - Desarrollado por Th√©o Fief";
            break;
          default:
            versionMsg = "Simon Game Version 1.1.2 - Developed by Th√©o Fief";
        }
        alert(versionMsg);
      }

      function selectLanguage() {
        document.querySelector(".menu").style.display = "none";
        document.querySelector(".language").style.display = "block";
        document.getElementById("backMenu").style.display = "block";
      }

      function setLanguage(lang) {
        language = lang;
        localStorage.setItem("simonLang", lang);
        updateTexts();
        document.querySelector(".language").style.display = "none";
        document.querySelector(".menu").style.display = "block";
      }

      function setDifficulty(diff) {
        difficulty = diff;
        document.querySelector(".difficulty").style.display = "none";
        document.getElementById("gameButtons").style.display = "grid";
        updateScore();
        showBackToMenuButton(true);
        nextStep();
      }

      function resetScores() {
        if (confirm("Voulez-vous vraiment r√©initialiser les scores ?")) {
          highScores[difficulty] = 0;
          localStorage.setItem("simonHighScores", JSON.stringify(highScores));
          updateScore();
          alert("Scores r√©initialis√©s ! üëç");
        }
      }

      function updateStatus(text) {
        document.getElementById("status").textContent = text;

        if (
          text === messages.lose[language] ||
          text === messages.win[language]
        ) {
          document.getElementById("backMenu").style.display = "block"; // fin du jeu
        } else {
          document.getElementById("backMenu").style.display = "none";
        }
      }

      async function flash(color) {
        const btn = document.getElementById(color);
        btn.style.opacity = "0.3";
        await delay(400 - difficulty * 100);
        btn.style.opacity = "1";
        await delay(200 - difficulty * 50);
      }

      async function playSequence() {
        for (let i = 0; i < sequence.length; i++) {
          await flash(colors[sequence[i]]);
        }
      }

      async function nextStep() {
        level++;
        updateScore();
        const nextColor = Math.floor(Math.random() * 4);
        sequence.push(nextColor);
        userSequence = [];
        await delay(500);
        await playSequence();
      }

      async function handleUserInput(colorIndex) {
        userSequence.push(colorIndex);
        await flash(colors[colorIndex]); // ajout de await ici pour que l'animation soit fluide
        const index = userSequence.length - 1;
        if (userSequence[index] !== sequence[index]) {
          updateStatus(messages.lose[language]);
          checkHighScore(level - 1);
          showBackToMenuButton(true);
          return;
        }

        if (userSequence.length === sequence.length) {
          updateStatus(messages.win[language]);
          showBackToMenuButton(true);
          setTimeout(() => {
            showBackToMenuButton(false);
            nextStep();
          }, 1000);
        }
      }

      function checkHighScore(score) {
        if (score > highScores[difficulty]) {
          highScores[difficulty] = score;
          localStorage.setItem("simonHighScores", JSON.stringify(highScores));
          updateScore();
        }
      }

      window.onload = () => {
        updateTexts();
        goToMenu();
      };
    </script>
  </body>
</html>
